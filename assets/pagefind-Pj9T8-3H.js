const me="1.4.0";let ee;(function(){const e={};let r;typeof document<"u"&&document.currentScript!==null&&(r=new URL("UNHANDLED",location.href).toString());let t,n=0,i=null;function l(){return(i===null||i.byteLength===0)&&(i=new Uint8Array(t.memory.buffer)),i}const w=typeof TextEncoder<"u"?new TextEncoder("utf-8"):{encode:()=>{throw Error("TextEncoder not available")}},c=typeof w.encodeInto=="function"?function(a,f){return w.encodeInto(a,f)}:function(a,f){const d=w.encode(a);return f.set(d),{read:a.length,written:d.length}};function s(a,f,d){if(d===void 0){const k=w.encode(a),P=f(k.length,1)>>>0;return l().subarray(P,P+k.length).set(k),n=k.length,P}let h=a.length,p=f(h,1)>>>0;const g=l();let y=0;for(;y<h;y++){const k=a.charCodeAt(y);if(k>127)break;g[p+y]=k}if(y!==h){y!==0&&(a=a.slice(y)),p=d(p,h,h=y+a.length*3,1)>>>0;const k=l().subarray(p+y,p+h),P=c(a,k);y+=P.written,p=d(p,h,y,1)>>>0}return n=y,p}let o=null;function u(){return(o===null||o.byteLength===0)&&(o=new Int32Array(t.memory.buffer)),o}const b=typeof TextDecoder<"u"?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};typeof TextDecoder<"u"&&b.decode();function x(a,f){return a=a>>>0,b.decode(l().subarray(a,a+f))}e.request_indexes=function(a,f){let d,h;try{const y=t.__wbindgen_add_to_stack_pointer(-16),k=s(f,t.__wbindgen_malloc,t.__wbindgen_realloc),P=n;t.request_indexes(y,a,k,P);var p=u()[y/4+0],g=u()[y/4+1];return d=p,h=g,x(p,g)}finally{t.__wbindgen_add_to_stack_pointer(16),t.__wbindgen_free(d,h,1)}},e.filters=function(a){let f,d;try{const g=t.__wbindgen_add_to_stack_pointer(-16);t.filters(g,a);var h=u()[g/4+0],p=u()[g/4+1];return f=h,d=p,x(h,p)}finally{t.__wbindgen_add_to_stack_pointer(16),t.__wbindgen_free(f,d,1)}},e.request_filter_indexes=function(a,f){let d,h;try{const y=t.__wbindgen_add_to_stack_pointer(-16),k=s(f,t.__wbindgen_malloc,t.__wbindgen_realloc),P=n;t.request_filter_indexes(y,a,k,P);var p=u()[y/4+0],g=u()[y/4+1];return d=p,h=g,x(p,g)}finally{t.__wbindgen_add_to_stack_pointer(16),t.__wbindgen_free(d,h,1)}},e.enter_playground_mode=function(a){return t.enter_playground_mode(a)>>>0},e.request_all_filter_indexes=function(a){let f,d;try{const g=t.__wbindgen_add_to_stack_pointer(-16);t.request_all_filter_indexes(g,a);var h=u()[g/4+0],p=u()[g/4+1];return f=h,d=p,x(h,p)}finally{t.__wbindgen_add_to_stack_pointer(16),t.__wbindgen_free(f,d,1)}};function U(a,f){const d=f(a.length*1,1)>>>0;return l().set(a,d/1),n=a.length,d}e.init_pagefind=function(a){const f=U(a,t.__wbindgen_malloc),d=n;return t.init_pagefind(f,d)>>>0},e.search=function(a,f,d,h,p){let g,y;try{const W=t.__wbindgen_add_to_stack_pointer(-16),_=s(f,t.__wbindgen_malloc,t.__wbindgen_realloc),A=n,R=s(d,t.__wbindgen_malloc,t.__wbindgen_realloc),$=n,v=s(h,t.__wbindgen_malloc,t.__wbindgen_realloc),O=n;t.search(W,a,_,A,R,$,v,O,p);var k=u()[W/4+0],P=u()[W/4+1];return g=k,y=P,x(k,P)}finally{t.__wbindgen_add_to_stack_pointer(16),t.__wbindgen_free(g,y,1)}},e.load_index_chunk=function(a,f){const d=U(f,t.__wbindgen_malloc),h=n;return t.load_index_chunk(a,d,h)>>>0},e.add_synthetic_filter=function(a,f){const d=s(f,t.__wbindgen_malloc,t.__wbindgen_realloc),h=n;return t.add_synthetic_filter(a,d,h)>>>0},e.set_ranking_weights=function(a,f){const d=s(f,t.__wbindgen_malloc,t.__wbindgen_realloc),h=n;return t.set_ranking_weights(a,d,h)>>>0},e.load_filter_chunk=function(a,f){const d=U(f,t.__wbindgen_malloc),h=n;return t.load_filter_chunk(a,d,h)>>>0};async function C(a,f){if(typeof Response=="function"&&a instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(a,f)}catch(h){if(a.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",h);else throw h}const d=await a.arrayBuffer();return await WebAssembly.instantiate(d,f)}else{const d=await WebAssembly.instantiate(a,f);return d instanceof WebAssembly.Instance?{instance:d,module:a}:d}}function T(){const a={};return a.wbg={},a}function S(a,f){return t=a.exports,L.__wbindgen_wasm_module=f,o=null,i=null,t}function q(a){if(t!==void 0)return t;const f=T();a instanceof WebAssembly.Module||(a=new WebAssembly.Module(a));const d=new WebAssembly.Instance(a,f);return S(d,a)}async function L(a){if(t!==void 0)return t;typeof a>"u"&&typeof r<"u"&&(a=r.replace(/\.js$/,"_bg.wasm"));const f=T();(typeof a=="string"||typeof Request=="function"&&a instanceof Request||typeof URL=="function"&&a instanceof URL)&&(a=fetch(a));const{instance:d,module:h}=await C(await a,f);return S(d,h)}ee=Object.assign(L,{initSync:q},e)})();var F=Uint8Array,j=Uint16Array,le=Uint32Array,ce=new F([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),fe=new F([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),ye=new F([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),de=function(e,r){for(var t=new j(31),n=0;n<31;++n)t[n]=r+=1<<e[n-1];for(var i=new le(t[30]),n=1;n<30;++n)for(var l=t[n];l<t[n+1];++l)i[l]=l-t[n]<<5|n;return[t,i]},he=de(ce,2),ue=he[0],be=he[1];ue[28]=258,be[258]=28;var ve=de(fe,0),ke=ve[0],_e=new j(32768);for(m=0;m<32768;++m)I=(m&43690)>>>1|(m&21845)<<1,I=(I&52428)>>>2|(I&13107)<<2,I=(I&61680)>>>4|(I&3855)<<4,_e[m]=((I&65280)>>>8|(I&255)<<8)>>>1;var I,m,z=function(e,r,t){for(var n=e.length,i=0,l=new j(r);i<n;++i)e[i]&&++l[e[i]-1];var w=new j(r);for(i=0;i<r;++i)w[i]=w[i-1]+l[i-1]<<1;var c;{c=new j(1<<r);var s=15-r;for(i=0;i<n;++i)if(e[i])for(var o=i<<4|e[i],u=r-e[i],b=w[e[i]-1]++<<u,x=b|(1<<u)-1;b<=x;++b)c[_e[b]>>>s]=o}return c},G=new F(288);for(m=0;m<144;++m)G[m]=8;var m;for(m=144;m<256;++m)G[m]=9;var m;for(m=256;m<280;++m)G[m]=7;var m;for(m=280;m<288;++m)G[m]=8;var m,ge=new F(32);for(m=0;m<32;++m)ge[m]=5;var m,Pe=z(G,9),xe=z(ge,5),H=function(e){for(var r=e[0],t=1;t<e.length;++t)e[t]>r&&(r=e[t]);return r},E=function(e,r,t){var n=r/8|0;return(e[n]|e[n+1]<<8)>>(r&7)&t},Q=function(e,r){var t=r/8|0;return(e[t]|e[t+1]<<8|e[t+2]<<16)>>(r&7)},Se=function(e){return(e+7)/8|0},$e=function(e,r,t){(t==null||t>e.length)&&(t=e.length);var n=new(e.BYTES_PER_ELEMENT==2?j:e.BYTES_PER_ELEMENT==4?le:F)(t-r);return n.set(e.subarray(r,t)),n},Fe=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],D=function(e,r,t){var n=new Error(r||Fe[e]);if(n.code=e,Error.captureStackTrace&&Error.captureStackTrace(n,D),!t)throw n;return n},Ue=function(e,r,t){var n=e.length;if(!n||t&&t.f&&!t.l)return r||new F(0);var i=!r||t,l=!t||t.i;t||(t={}),r||(r=new F(n*3));var w=function(ae){var ie=r.length;if(ae>ie){var se=new F(Math.max(ie*2,ae));se.set(r),r=se}},c=t.f||0,s=t.p||0,o=t.b||0,u=t.l,b=t.d,x=t.m,U=t.n,C=n*8;do{if(!u){c=E(e,s,1);var T=E(e,s+1,3);if(s+=3,T)if(T==1)u=Pe,b=xe,x=9,U=5;else if(T==2){var a=E(e,s,31)+257,f=E(e,s+10,15)+4,d=a+E(e,s+5,31)+1;s+=14;for(var h=new F(d),p=new F(19),g=0;g<f;++g)p[ye[g]]=E(e,s+g*3,7);s+=f*3;for(var y=H(p),k=(1<<y)-1,P=z(p,y),g=0;g<d;){var W=P[E(e,s,k)];s+=W&15;var S=W>>>4;if(S<16)h[g++]=S;else{var _=0,A=0;for(S==16?(A=3+E(e,s,3),s+=2,_=h[g-1]):S==17?(A=3+E(e,s,7),s+=3):S==18&&(A=11+E(e,s,127),s+=7);A--;)h[g++]=_}}var R=h.subarray(0,a),$=h.subarray(a);x=H(R),U=H($),u=z(R,x),b=z($,U)}else D(1);else{var S=Se(s)+4,q=e[S-4]|e[S-3]<<8,L=S+q;if(L>n){l&&D(0);break}i&&w(o+q),r.set(e.subarray(S,L),o),t.b=o+=q,t.p=s=L*8,t.f=c;continue}if(s>C){l&&D(0);break}}i&&w(o+131072);for(var v=(1<<x)-1,O=(1<<U)-1,K=s;;K=s){var _=u[Q(e,s)&v],N=_>>>4;if(s+=_&15,s>C){l&&D(0);break}if(_||D(2),N<256)r[o++]=N;else if(N==256){K=s,u=null;break}else{var re=N-254;if(N>264){var g=N-257,J=ce[g];re=E(e,s,(1<<J)-1)+ue[g],s+=J}var V=b[Q(e,s)&O],Y=V>>>4;V||D(3),s+=V&15;var $=ke[Y];if(Y>3){var J=fe[Y];$+=Q(e,s)&(1<<J)-1,s+=J}if(s>C){l&&D(0);break}i&&w(o+131072);for(var ne=o+re;o<ne;o+=4)r[o]=r[o-$],r[o+1]=r[o+1-$],r[o+2]=r[o+2-$],r[o+3]=r[o+3-$];o=ne}}t.l=u,t.p=K,t.b=o,t.f=c,u&&(c=1,t.m=x,t.d=b,t.n=U)}while(!c);return o==r.length?r:$e(r,0,o)},Ae=new F(0),Ee=function(e){(e[0]!=31||e[1]!=139||e[2]!=8)&&D(6,"invalid gzip data");var r=e[3],t=10;r&4&&(t+=e[10]|(e[11]<<8)+2);for(var n=(r>>3&1)+(r>>4&1);n>0;n-=!e[t++]);return t+(r&2)},Me=function(e){var r=e.length;return(e[r-4]|e[r-3]<<8|e[r-2]<<16|e[r-1]<<24)>>>0};function Le(e,r){return Ue(e.subarray(Ee(e),-8),r||new F(Me(e)))}var We=typeof TextDecoder<"u"&&new TextDecoder,Ie=0;try{We.decode(Ae,{stream:!0}),Ie=1}catch{}var De=Le,pe=(e,r)=>{if(e.length===0)return 0;let t=[];for(const c of e)t[c.location]=t[c.location]||0,t[c.location]+=c.balanced_score;if(t.length<=r)return 0;let n=t.slice(0,r).reduce((c,s)=>c+s,0),i=n,l=[0];for(let c=0;c<t.length;c++){const s=c+r;i+=(t[s]??0)-(t[c]??0),i>n?(n=i,l=[c]):i===n&&l[l.length-1]===c-1&&l.push(c)}return l[Math.floor(l.length/2)]},we=(e,r,t,n,i,l)=>{let w=e.includes("​"),c=[];w?c=e.split("​"):c=e.split(/[\r\n\s]+/g);for(let u of n)c[u]?.startsWith("<mark>")||(c[u]=`<mark>${c[u]}</mark>`);let s=l??c.length,o=i??0;return s-o<t&&(t=s-o),r+t>s&&(r=s-t),r<o&&(r=o),c.slice(r,r+t).join(w?"":" ").trim()},Te=(e,r)=>{const t=e.anchors.filter(c=>/h\d/i.test(c.element)&&c.text?.length&&/\S/.test(c.text)).sort((c,s)=>c.location-s.location),n=[];let i=0,l={title:e.meta.title,url:e.url,weighted_locations:[],locations:[],excerpt:""};const w=c=>{if(l.locations.length){const s=l.weighted_locations.map(b=>({weight:b.weight,balanced_score:b.balanced_score,location:b.location-i})),o=pe(s,r)+i,u=c?Math.min(c-o,r):r;l.excerpt=we(e.raw_content??"",o,u,l.locations,i,c),n.push(l)}};for(let c of e.weighted_locations)if(!t.length||c.location<t[0].location)l.weighted_locations.push(c),l.locations.push(c.location);else{let s=t.shift();for(w(s.location);t.length&&c.location>=t[0].location;)s=t.shift();let o=e.url;try{if(/^((https?:)?\/\/)/.test(o)){let b=new URL(o);b.hash=s.id,o=b.toString()}else{/^\//.test(o)||(o=`/${o}`);let b=new URL(`https://example.com${o}`);b.hash=s.id,o=b.toString().replace(/^https:\/\/example.com/,"")}}catch{console.error(`Pagefind: Couldn't process ${o} for a search result`)}i=s.location,l={title:s.text,url:o,anchor:s,weighted_locations:[c],locations:[c.location],excerpt:""}}return w(t[0]?.location),n},X=async(e=100)=>new Promise(r=>setTimeout(r,e)),Z=typeof window<"u"&&typeof document<"u",oe=class{constructor(e={}){this.version=me,this.backend=ee,this.decoder=new TextDecoder("utf-8"),this.wasm=null,this.basePath=e.basePath||"/pagefind/",this.primary=e.primary||!1,this.primary&&!e.basePath&&this.initPrimary(),/[^\/]$/.test(this.basePath)&&(this.basePath=`${this.basePath}/`),Z&&window?.location?.origin&&this.basePath.startsWith(window.location.origin)&&(this.basePath=this.basePath.replace(window.location.origin,"")),this.baseUrl=e.baseUrl||this.defaultBaseUrl(),/^(\/|https?:\/\/)/.test(this.baseUrl)||(this.baseUrl=`/${this.baseUrl}`),this.indexWeight=e.indexWeight??1,this.excerptLength=e.excerptLength??30,this.mergeFilter=e.mergeFilter??{},this.ranking=e.ranking,this.highlightParam=e.highlightParam??null,this.loaded_chunks={},this.loaded_filters={},this.loaded_fragments={},this.raw_ptr=null,this.searchMeta=null,this.languages=null}initPrimary(){if(Z&&typeof import.meta.url<"u"){let e=import.meta.url.match(/^(.*\/)pagefind.js.*$/)?.[1];e?this.basePath=e:console.warn(["Pagefind couldn't determine the base of the bundle from the import path. Falling back to the default.","Set a basePath option when initialising Pagefind to ignore this message."].join(`
`))}}defaultBaseUrl(){return this.basePath.match(/^(.*\/)_?pagefind/)?.[1]||"/"}async options(e){const r=["basePath","baseUrl","indexWeight","excerptLength","mergeFilter","highlightParam","ranking"];for(const[t,n]of Object.entries(e))if(t==="mergeFilter"){let i=this.stringifyFilters(n),l=await this.getPtr();this.raw_ptr=this.backend.add_synthetic_filter(l,i)}else t==="ranking"?await this.set_ranking(e.ranking):r.includes(t)?(t==="basePath"&&typeof n=="string"&&(this.basePath=n),t==="baseUrl"&&typeof n=="string"&&(this.baseUrl=n),t==="indexWeight"&&typeof n=="number"&&(this.indexWeight=n),t==="excerptLength"&&typeof n=="number"&&(this.excerptLength=n),t==="mergeFilter"&&typeof n=="object"&&(this.mergeFilter=n),t==="highlightParam"&&typeof n=="string"&&(this.highlightParam=n)):console.warn(`Unknown Pagefind option ${t}. Allowed options: [${r.join(", ")}]`)}async enterPlaygroundMode(){let e=await this.getPtr();this.raw_ptr=this.backend.enter_playground_mode(e)}decompress(e,r="unknown file"){return this.decoder.decode(e.slice(0,12))==="pagefind_dcd"?e.slice(12):(e=De(e),this.decoder.decode(e.slice(0,12))!=="pagefind_dcd"?(console.error(`Decompressing ${r} appears to have failed: Missing signature`),e):e.slice(12))}async set_ranking(e){if(!e)return;let r={term_similarity:e.termSimilarity??null,page_length:e.pageLength??null,term_saturation:e.termSaturation??null,term_frequency:e.termFrequency??null},t=await this.getPtr();this.raw_ptr=this.backend.set_ranking_weights(t,JSON.stringify(r))}async init(e,r){await this.loadEntry();let t=this.findIndex(e),n=t.wasm?t.wasm:"unknown";this.loadedLanguage=e;let i=[this.loadMeta(t.hash)];if(r.load_wasm===!0&&i.push(this.loadWasm(n)),await Promise.all(i),this.raw_ptr=this.backend.init_pagefind(new Uint8Array(this.searchMeta)),Object.keys(this.mergeFilter)?.length){let l=this.stringifyFilters(this.mergeFilter),w=await this.getPtr();this.raw_ptr=this.backend.add_synthetic_filter(w,l)}this.ranking&&await this.set_ranking(this.ranking)}async loadEntry(){try{let r=await(await fetch(`${this.basePath}pagefind-entry.json?ts=${Date.now()}`)).json();this.languages=r.languages,this.loadedVersion=r.version,this.includeCharacters=r.include_characters??[],r.version!==this.version&&(this.primary?console.warn(["Pagefind JS version doesn't match the version in your search index.",`Pagefind JS: ${this.version}. Pagefind index: ${r.version}`,"If you upgraded Pagefind recently, you likely have a cached pagefind.js file.","If you encounter any search errors, try clearing your cache."].join(`
`)):console.warn(["Merging a Pagefind index from a different version than the main Pagefind instance.",`Main Pagefind JS: ${this.version}. Merged index (${this.basePath}): ${r.version}`,"If you encounter any search errors, make sure that both sites are running the same version of Pagefind."].join(`
`)))}catch(e){throw console.error(`Failed to load Pagefind metadata:
${e?.toString()}`),new Error("Failed to load Pagefind metadata")}}findIndex(e){if(this.languages){let r=this.languages[e];if(r||(r=this.languages[e.split("-")[0]],r))return r;let t=Object.values(this.languages).sort((n,i)=>i.page_count-n.page_count);if(t[0])return t[0]}throw new Error("Pagefind Error: No language indexes found.")}async loadMeta(e){try{let t=await(await fetch(`${this.basePath}pagefind.${e}.pf_meta`)).arrayBuffer();this.searchMeta=this.decompress(new Uint8Array(t),"Pagefind metadata")}catch(r){console.error(`Failed to load the meta index:
${r?.toString()}`)}}async loadWasm(e){try{const r=`${this.basePath}wasm.${e}.pagefind`;let n=await(await fetch(r)).arrayBuffer();const i=this.decompress(new Uint8Array(n),"Pagefind WebAssembly");if(!i)throw new Error("No WASM after decompression");this.wasm=await this.backend(i)}catch(r){throw console.error(`Failed to load the Pagefind WASM:
${r?.toString()}`),new Error(`Failed to load the Pagefind WASM:
${r?.toString()}`)}}async _loadGenericChunk(e,r){try{let n=await(await fetch(e)).arrayBuffer(),i=this.decompress(new Uint8Array(n),e),l=await this.getPtr();this.raw_ptr=this.backend[r](l,i)}catch(t){console.error(`Failed to load the index chunk ${e}:
${t?.toString()}`)}}async loadChunk(e){if(!this.loaded_chunks[e]){const r=`${this.basePath}index/${e}.pf_index`;this.loaded_chunks[e]=this._loadGenericChunk(r,"load_index_chunk")}return await this.loaded_chunks[e]}async loadFilterChunk(e){if(!this.loaded_filters[e]){const r=`${this.basePath}filter/${e}.pf_filter`;this.loaded_filters[e]=this._loadGenericChunk(r,"load_filter_chunk")}return await this.loaded_filters[e]}async _loadFragment(e){let t=await(await fetch(`${this.basePath}fragment/${e}.pf_fragment`)).arrayBuffer(),n=this.decompress(new Uint8Array(t),`Fragment ${e}`);return JSON.parse(new TextDecoder().decode(n))}async loadFragment(e,r=[],t){this.loaded_fragments[e]||(this.loaded_fragments[e]=this._loadFragment(e));let n=await this.loaded_fragments[e];n.weighted_locations=r,n.locations=r.map(l=>l.location),n.raw_content||(n.raw_content=n.content.replace(/</g,"&lt;").replace(/>/g,"&gt;"),n.content=n.content.replace(/\u200B/g,"")),n.raw_url||(n.raw_url=n.url),n.url=this.processedUrl(n.raw_url,t);const i=pe(r,this.excerptLength);return n.excerpt=we(n.raw_content,i,this.excerptLength,n.locations),n.sub_results=Te(n,this.excerptLength),n}fullUrl(e){return/^(https?:)?\/\//.test(e)?e:`${this.baseUrl}/${e}`.replace(/\/+/g,"/").replace(/^(https?:\/)/,"$1/")}processedUrl(e,r){const t=this.fullUrl(e);if(this.highlightParam===null)return t;let n=r.split(/\s+/);try{let i=new URL(t);for(const l of n)i.searchParams.append(this.highlightParam,l);return i.toString()}catch{try{let l=new URL(`https://example.com${t}`);for(const w of n)l.searchParams.append(this.highlightParam,w);return l.toString().replace(/^https:\/\/example\.com/,"")}catch{return t}}}async getPtr(){for(;this.raw_ptr===null;)await X(50);if(!this.raw_ptr)throw console.error("Pagefind: WASM Error (No pointer)"),new Error("Pagefind: WASM Error (No pointer)");return this.raw_ptr}stringifyFilters(e={}){return JSON.stringify(e)}stringifySorts(e={}){let r=Object.entries(e);for(let[t,n]of r)return r.length>1&&console.warn(`Pagefind was provided multiple sort options in this search, but can only operate on one. Using the ${t} sort.`),n!=="asc"&&n!=="desc"&&console.warn(`Pagefind was provided a sort with unknown direction ${n}. Supported: [asc, desc]`),`${t}:${n}`;return""}async filters(){let e=await this.getPtr(),r=this.backend.request_all_filter_indexes(e),t=JSON.parse(r);if(Array.isArray(t)){let i=t.filter(l=>l).map(l=>this.loadFilterChunk(l));await Promise.all([...i])}e=await this.getPtr();let n=this.backend.filters(e);return JSON.parse(n)}async preload(e,r={}){await this.search(e,{...r,preload:!0})}async search(e,r={}){r={verbose:!1,filters:{},sort:{},...r};const t=_=>{r.verbose&&console.log(_)};t(`Starting search on ${this.basePath}`);let n=Date.now(),i=await this.getPtr(),l=e===null;e=e??"";let w=/^\s*".+"\s*$/.test(e);w&&t("Running an exact search");let c=null;try{c=Intl.getCanonicalLocales(this.loadedLanguage)[0]}catch{}const s=[];let o;c&&typeof Intl.Segmenter<"u"?o=[...new Intl.Segmenter(c,{granularity:"grapheme"}).segment(e)].map(({segment:A})=>A):o=[...e];for(const _ of o)this.includeCharacters?.includes(_)?s.push(_):new RegExp("^\\p{Pd}|\\p{Pe}|\\p{Pf}|\\p{Pi}|\\p{Po}|\\p{Ps}$","u").test(_)||s.push(_.toLocaleLowerCase());if(e=s.join("").replace(/\s{2,}/g," ").trim(),t(`Normalized search term to ${e}`),!e?.length&&!l)return{results:[],unfilteredResultCount:0,filters:{},totalFilters:{},timings:{preload:Date.now()-n,search:Date.now()-n,total:Date.now()-n}};let u=this.stringifySorts(r.sort);t(`Stringified sort to ${u}`);const b=this.stringifyFilters(r.filters);t(`Stringified filters to ${b}`);let x=this.backend.request_indexes(i,e),U=JSON.parse(x),C=this.backend.request_filter_indexes(i,b),T=JSON.parse(C),S=U.filter(_=>_).map(_=>this.loadChunk(_)),q=T.filter(_=>_).map(_=>this.loadFilterChunk(_));if(await Promise.all([...S,...q]),t("Loaded necessary chunks to run search"),r.preload)return t("Preload — bailing out of search operation now."),null;i=await this.getPtr();let L=Date.now(),a=this.backend.search(i,e,b,u,w);t(`Got the raw search result: ${a}`);let{filtered_counts:f,total_counts:d,results:h,unfiltered_total:p,search_keywords:g}=JSON.parse(a),y=h.map(_=>{let A=_.l.map(v=>{let O={weight:v.w/24,balanced_score:v.s,location:v.l};return v.v&&(O.verbose={word_string:v.v.ws,length_bonus:v.v.lb}),O}),R=A.map(v=>v.location),$={id:_.p,score:_.s*this.indexWeight,words:R,data:async()=>await this.loadFragment(_.p,A,e)};return _.params&&($.params={document_length:_.params.dl,average_page_length:_.params.apl,total_pages:_.params.tp}),_.scores&&($.scores=_.scores.map(v=>({search_term:v.w,idf:v.idf,saturating_tf:v.b_tf,raw_tf:v.r_tf,pagefind_tf:v.p_tf,score:v.s,params:{weighted_term_frequency:v.params.w_tf,pages_containing_term:v.params.pct,length_bonus:v.params.lb}}))),$});const k=Date.now()-L,P=Date.now()-n;t(`Found ${h.length} result${h.length==1?"":"s"} for "${e}" in ${Date.now()-L}ms (${Date.now()-n}ms realtime)`);let W={results:y,unfilteredResultCount:p,filters:f,totalFilters:d,timings:{preload:P-k,search:k,total:P}};return g&&(W.search_keywords=g),W}},Ce=class{constructor(e={}){this.backend=ee,this.primaryLanguage="unknown",this.searchID=0,this.primary=new oe({...e,primary:!0}),this.instances=[this.primary],this.init(e?.language)}async options(e){await this.primary.options(e)}async enterPlaygroundMode(){await this.primary.enterPlaygroundMode()}async init(e){if(Z&&document?.querySelector){const r=document.querySelector("html")?.getAttribute("lang")||"unknown";this.primaryLanguage=r.toLocaleLowerCase()}await this.primary.init(e||this.primaryLanguage,{load_wasm:!0})}async mergeIndex(e,r={}){if(this.primary.basePath.startsWith(e)){console.warn(`Skipping mergeIndex ${e} that appears to be the same as the primary index (${this.primary.basePath})`);return}let t=new oe({primary:!1,basePath:e});for(this.instances.push(t);this.primary.wasm===null;)await X(50);await t.init(r.language||this.primaryLanguage,{load_wasm:!1}),delete r.language,await t.options(r)}mergeFilters(e){const r={};for(const t of e)for(const[n,i]of Object.entries(t))if(r[n]){const l=r[n];for(const[w,c]of Object.entries(i))l[w]=(l[w]||0)+c}else{r[n]=i;continue}return r}async filters(){let e=await Promise.all(this.instances.map(r=>r.filters()));return this.mergeFilters(e)}async preload(e,r={}){await Promise.all(this.instances.map(t=>t.preload(e,r)))}async debouncedSearch(e,r,t){const n=++this.searchID;if(this.preload(e,r),await X(t),n!==this.searchID)return null;const i=await this.search(e,r);return n!==this.searchID?null:i}async search(e,r={}){let t=await Promise.all(this.instances.map(o=>o.search(e,r)));const n=this.mergeFilters(t.map(o=>o.filters)),i=this.mergeFilters(t.map(o=>o.totalFilters)),l=t.map(o=>o.results).flat().sort((o,u)=>u.score-o.score),w=t.map(o=>o.timings),c=t.reduce((o,u)=>o+u.unfilteredResultCount,0);let s={results:l,unfilteredResultCount:c,filters:n,totalFilters:i,timings:w};return t[0].search_keywords&&(s.search_keywords=t[0].search_keywords),s}},M=void 0,te=void 0,B=()=>{M||(M=new Ce(te??{}))},qe=async e=>{M?await M.options(e):te=e},Re=async()=>{B()},Oe=async()=>{M=void 0,te=void 0},Ne=async(e,r)=>(B(),await M.mergeIndex(e,r)),je=async(e,r)=>(B(),await M.search(e,r)),Be=async(e,r,t=300)=>(B(),await M.debouncedSearch(e,r,t)),Je=async(e,r)=>(B(),await M.preload(e,r)),ze=async()=>(B(),await M.filters());export{Be as debouncedSearch,Oe as destroy,ze as filters,Re as init,Ne as mergeIndex,qe as options,Je as preload,je as search};
